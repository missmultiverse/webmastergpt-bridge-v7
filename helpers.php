<?php
/**
 * File: helpers.php
 * Purpose: Contains shared utility functions such as logging for GPT actions.
 */

/**
 * ðŸ› ï¸ Developer Note:
 * This file is part of the WebmasterGPT Bridge plugin and MUST adhere to the following
 * hyper-descriptive structural and formatting conventions at all times:
 *
 * âœ… SECTION HEADERS
 *   â€” Every logical section of the code must begin with a **3-line banner** formatted as:
 *         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *         â”‚ --- START --- {SECTION NAME IN CAPS}                         â”‚
 *         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *   â€” Every section must end with a **1-line compact footer** formatted as:
 *         // --- END --- {SECTION NAME IN CAPS} ---------------------------
 *
 * âœ… FILE ORGANIZATION
 *   â€” All code must be grouped **logically by purpose**, such as:
 *         â†’ Identity & authentication logic
 *         â†’ Permissions & role systems
 *         â†’ Admin UI or settings logic
 *         â†’ REST API registration and handlers
 *         â†’ Utility or helper functions
 *
 * âœ… CODE STYLE & RELIABILITY
 *   â€” All logic must be explicit and fail-safe:
 *         â†’ Do not allow silent failures
 *         â†’ Always log or return errors with meaningful context
 *         â†’ Avoid ambiguous variable names or logic branches
 *
 * ðŸš¨ DO NOT REMOVE THIS DEVELOPER NOTE FROM ANY FILE.
 * It serves as a shared convention contract across the entire GPT plugin codebase.
 */
// ----------------------------------------------------------------
// --- START --- LOGGING UTILITY ----------------------------------
// ----------------------------------------------------------------

/**
 * Logs REST and system events for debugging GPT actions.
 *
 * @param string $channel  Log file name (e.g. REST, Sync)
 * @param string $message  Human-readable log message
 * @param mixed  $data     Optional array or string with structured payload
 */
function wgpt_log($channel, $message, $data = null) {
    $timestamp = date('Y-m-d H:i:s');
    $entry = [
        'timestamp' => $timestamp,
        'channel'   => strtoupper($channel),
        'message'   => $message,
        'data'      => $data
    ];

    $dir = plugin_dir_path(__FILE__) . 'logs/';
    $file = $dir . strtolower($channel) . '.log.json';

    if (!file_exists($dir)) {
        mkdir($dir, 0755, true);
    }

    file_put_contents($file, json_encode($entry, JSON_PRETTY_PRINT) . ",\n", FILE_APPEND);
}
// --- END --- LOGGING UTILITY ------------------------------------
